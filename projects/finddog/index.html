<html>
	<head>
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		/>
	</head>
	<style>
		.dog {
			box-sizing: border-box;
		}
		.dog p {
			max-height: 200px;
			overflow: auto;
		}
		.dog .name {
			background: rgba(10, 10, 10, 0.8);
		}
	</style>
	<body>
		<div id="dogList" class="row"></div>
		<script>
			var filters = {};
			async function getDogs() {
				var res = await fetch("/dogs/api/dog");
				var dogs = JSON.parse(await res.text());
				return dogs;
			}
			function getDogEl(dog) {
				var specs = "";
				for (prop in dog) {
					if (["Name", "Age", "Photo"].indexOf(prop) > -1) continue;
					if (dog[prop].toString().length === 0) continue;
					specs += `<b>${prop}</b>: ${dog[prop]}<br>`;
				}
				var $el = document.createElement("div");
				$el.className = "dog col-12 col-sm-6 col-md-4 col-lg-3";
				$el.id = dog.Name;
				$el.innerHTML = `
                    <div class="m-2 p-3 shadow-sm position-relative">
                        <h5 class="position-absolute px-3 py-1 text-white name">${dog.Name}</h5>
                        <img class="img-fluid mx-auto d-inline-block" src="${dog.Photo}" />
                        <p>
                            ${specs}
                        </p>
                        <div class="actions">
                            <button class="btn btn-primary"><i class="fa fa-star text-warning">Favourite</i></button>    
                        </div>
                    </div>
                `;
				return $el;
			}
			async function refreshDogs() {
				function applyFilters(dogs) {
					return dogs.filter(d => {
						for (filter in filters) {
							if (
								typeof filters[filter] == "object" &&
								typeof filters[filter].length != "undefined"
							) {
								if (filters[filter].indexOf(d[filter]) == -1)
									return false;
								else continue;
							}
							if (d[filter] != filters[filter]) return false;
						}
						return true;
					});
				}
				var dogs = await getDogs();
				dogs = applyFilters(dogs);
				var $container = document.body.querySelector("#dogList");
				dogs.forEach(d => {
					$container.appendChild(getDogEl(d));
				});
			}
			function setupPage() {
				function setupListeners() {
					var $dogList = document.querySelector("#dogList");
					$dogList.addEventListener("click", e => {
						var $el = e.target;
						if ($el.className.indexOf("action favourite") > -1) {
							favouriteDog(
								$el.parentElement.parentElement.parentElement.id
							);
						}
					});
				}
			}
			async function init() {
				refreshDogs();
			}
			init();
		</script>
	</body>
</html>
